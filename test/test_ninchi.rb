require 'minitest/autorun'
require './test/utils'

class MoleculeCollection
  def initialize
    @hydrogen = Molecule.new(
      'test/testfiles/hydrogen/hydrogen.mol',
      'nInChI=1S/H2/c["(0-1)", "(0:1)(1:0)", "01-10", "10110", 22, "hex:16", "base32:m", "/c/h(0-1)"]'
    )

    @cisplatin = Molecule.new(
      'test/testfiles/cisplatin/cisplatin.mol',
      'nInChI=1S/H6Cl2N2Pt/c["(0-6)(1-6)(2-6)(3-7)(4-7)(5-7)(6-10)(7-10)(8-10)(9-10)", "(0:6)(1:6)(2:6)(3:7)(4:7)(5:7)(6:0,1,2,10)(7:3,4,5,10)(8:10)(9:10)(10:6,7,8,9)", "00000010000-00000010000-00000010000-00000001000-00000001000-00000001000-11100000001-00011100001-00000000001-00000000001-00000011110", "10000001000000000010000000000100000000000100000000001000000000010001110000000100011100001000000000010000000000100000011110", 2679235325161742555733669265448896542, "hex:204008010010020047011c20040081e", "base32:20g08040100g08s0ho804020u", "/c(6-10)(7-10)(8-10)(9-10)/h(0-6)(1-6)(2-6)(3-7)(4-7)(5-7)"]'
    )

    @tpp = Molecule.new(
      'test/testfiles/tpp/tpp.mol',
      'nInChI=1S/C20H14N4/c["(0-14)(1-15)(2-16)(3-17)(4-18)(5-19)(6-20)(7-21)(8-22)(9-23)(10-24)(11-25)(12-36)(13-37)(14-15)(14-27)(15-29)(16-17)(16-26)(17-28)(18-19)(18-30)(19-32)(20-26)(20-27)(21-22)(21-31)(22-33)(23-28)(23-30)(24-29)(24-31)(25-32)(25-33)(26-34)(27-36)(28-34)(29-36)(30-37)(31-35)(32-37)(33-35)", "(0:14)(1:15)(2:16)(3:17)(4:18)(5:19)(6:20)(7:21)(8:22)(9:23)(10:24)(11:25)(12:36)(13:37)(14:0,15,27)(15:1,14,29)(16:2,17,26)(17:3,16,28)(18:4,19,30)(19:5,18,32)(20:6,26,27)(21:7,22,31)(22:8,21,33)(23:9,28,30)(24:10,29,31)(25:11,32,33)(26:16,20,34)(27:14,20,36)(28:17,23,34)(29:15,24,36)(30:18,23,37)(31:21,24,35)(32:19,25,37)(33:22,25,35)(34:26,28)(35:31,33)(36:12,27,29)(37:13,30,32)", "00000000000000100000000000000000000000-00000000000000010000000000000000000000-00000000000000001000000000000000000000-00000000000000000100000000000000000000-00000000000000000010000000000000000000-00000000000000000001000000000000000000-00000000000000000000100000000000000000-00000000000000000000010000000000000000-00000000000000000000001000000000000000-00000000000000000000000100000000000000-00000000000000000000000010000000000000-00000000000000000000000001000000000000-00000000000000000000000000000000000010-00000000000000000000000000000000000001-10000000000000010000000000010000000000-01000000000000100000000000000100000000-00100000000000000100000000100000000000-00010000000000001000000000001000000000-00001000000000000001000000000010000000-00000100000000000010000000000000100000-00000010000000000000000000110000000000-00000001000000000000001000000001000000-00000000100000000000010000000000010000-00000000010000000000000000001010000000-00000000001000000000000000000101000000-00000000000100000000000000000000110000-00000000000000001000100000000000001000-00000000000000100000100000000000000010-00000000000000000100000100000000001000-00000000000000010000000010000000000010-00000000000000000010000100000000000001-00000000000000000000010010000000000100-00000000000000000001000001000000000001-00000000000000000000001001000000000100-00000000000000000000000000101000000000-00000000000000000000000000000001010000-00000000000010000000000000010100000000-00000000000001000000000000000010100000", "10000000000000010000000000000000000000000000000000000010000000000000000000000000000000000000010000000000000000000000000000000000000010000000000000000000000000000000000000010000000000000000000000000000000000000010000000000000000000000000000000000000010000000000000000000000000000000000000010000000000000000000000000000000000000010000000000000000000000000000000000000010000000000000000000000000000000000000010000000000000000000000000000000000000010000000000000000000000000000000000000000000000001000000000000000000000000000000000000001100000000000000100000000000100000000000100000000000010000000000000010000000000100000000000000100000000100000000000000100000000000010000000000010000000000000100000000000000100000000001000000000000100000000000010000000000000100000000000100000000000000000001100000000000000000100000000000000100000000100000000000000100000000000010000000000010000000000000100000000000000000010100000000000000000100000000000000000010100000000000000000100000000000000000000110000000000000000000010001000000000000010000000000000000010000010000000000000001000000000000000000100000100000000001000000000000000000100000000100000000000100000000000000000001000010000000000000100000000000000000000010010000000000100000000000000000000010000010000000000010000000000000000000000100100000000010000000000000000000000000000101000000000000000000000000000000000000000010100000000000000001000000000000001010000000000000000000001000000000000000010100000", 486773572896603887766553430730815119016853425780704952285097046942944929665696356876096362063931957932162435762812354842889776948682870280354801689218015120093931683962613137382140171551417222437965372319806536299004142971931413469636996070787424132754393872949852014362426960329679263630946356651262874078395192865528042145971831220316672793273686707236058923002536763055649626934018387127498073016878348761342648562812380768695746720, "hex:100020000000004000000000800000000100000000020000000004000000000800000000100000000020000000004000000000800000000100000000000080000000018001001001000800100200040200040020020008001002001000800200200003000040008040008004004001000028000200005000040000300000880020000820002000041002000040200200002100040000120040000104004000009004000000280000000005000080014000010000a0", "base32:g00g00000010000000200000004000000080000000g00000010000000200000004000000080000000g000000100000000020000000600200g0400g00g080080g00g0200g0100100g0200800g04000600080080g00g0200g010002g0020005000400030000h00200084002000420100020401000110020000i010000840100004g0g00001800000005000800a0000g0050", "/c(14-15)(14-27)(15-29)(16-17)(16-26)(17-28)(18-19)(18-30)(19-32)(20-26)(20-27)(21-22)(21-31)(22-33)(23-28)(23-30)(24-29)(24-31)(25-32)(25-33)(26-34)(27-36)(28-34)(29-36)(30-37)(31-35)(32-37)(33-35)/h(0-14)(1-15)(2-16)(3-17)(4-18)(5-19)(6-20)(7-21)(8-22)(9-23)(10-24)(11-25)(12-36)(13-37)"]',
    )
  end

  def molecules
    [@hydrogen, @cisplatin, @tpp]
  end
end

class SmokeTests < Minitest::Test
  # Metaprogramming shenanigans for test parameterization (as in pytest)
  # inspired by https://stackoverflow.com/questions/18770988/.
  MoleculeCollection.new.molecules.each do |molecule|
    define_method("test_ninchi_string_#{molecule.name}") do
      assert_equal molecule.reference_ninchi_string, molecule.ninchi_string(permute_molfile: false)
    end
  end
end
